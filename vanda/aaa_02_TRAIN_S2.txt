#!/bin/bash 
#PBS -j oe
#PBS -k oed
#PBS -N s2_o1
#PBS -l select=1:ncpus=72:mpiprocs=1:ompthreads=72:ngpus=1:mem=480GB
#PBS -l walltime=120:00:00

#setup
source /scratch/$USER/my_project/VLMR_dev/vanda/vanda_setup.sh

# run
singularity exec -e "$IMAGE" bash << EOF
export JAVA_HOME=$JDK_DIR
export PATH=\$JAVA_HOME/bin:\$PATH
export HF_HOME="$CACHE_DIR"
export TRANSFORMERS_CACHE="$CACHE_DIR"
export HF_DATASETS_CACHE="$CACHE_DIR"
export TORCH_HOME="$CACHE_DIR"
source $ENV_DIR/bin/activate
echo "Start: \$(date)"
java -version
python --version

chmod +x scripts/train_stage2.sh 
bash scripts/train_stage2.sh

echo "Done: \$(date)"
EOF